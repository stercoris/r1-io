'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var util = require('util');

const inspectable = (klass, { serialize = () => ({}), stringify = (instance, payload, context) => (`${context.stylize(klass.name, 'special')} ${context.inspect(payload)}`) } = {}) => {
    Object.defineProperty(klass.prototype, util.inspect.custom, {
        value(depth, inspectContext) {
            const context = {
                stylize: inspectContext.stylize,
                inspect: (payload, options) => {
                    var _a;
                    return (util.inspect(payload, {
                        ...inspectContext,
                        compact: (_a = options === null || options === void 0 ? void 0 : options.compact) !== null && _a !== void 0 ? _a : false
                    }));
                }
            };
            const payload = serialize(this);
            return stringify(this, payload, context);
        }
    });
};

const kInspectProperties = Symbol('kInspectProperties');
const Inspectable = (options = {}) => (
// eslint-disable-next-line @typescript-eslint/no-explicit-any
(klass) => {
    inspectable(klass, {
        ...options,
        serialize(instance) {
            var _a;
            const payload = (((_a = options.serialize) === null || _a === void 0 ? void 0 : _a.call(options, instance)) || {});
            for (const property of (Reflect.getMetadata(kInspectProperties, instance) || [])) {
                payload[property] = instance[property];
            }
            return payload;
        }
    });
    return klass;
});
const Inspect = (target, property) => {
    const metadata = (Reflect.getMetadata(kInspectProperties, target) || []);
    if (metadata.length === 0) {
        Reflect.defineMetadata(kInspectProperties, metadata, target);
    }
    metadata.push(property);
};

exports.Inspect = Inspect;
exports.Inspectable = Inspectable;
exports.inspectable = inspectable;
exports.kInspectProperties = kInspectProperties;
